name: Run lint & tests
on: [push]

jobs:
  lint:
    runs-on: macos-12
    steps:
      - uses: actions/checkout@v3

      - name: Install deps ðŸ“¡
        run: brew install swift-format xcbeautify

      - name: Run formatter ðŸŽ¨
        run: swift-format format -i -r ./JellyfishClientSdk/Sources/**/*.swift --configuration swift-format-config.json

      - name: Run lint ðŸ‘€
        run: swift-format lint -r -s ./JellyfishClientSdk/**/**/*.swift --configuration swift-format-config.json

      - name: Generate mocks ðŸ«¥
        run: cd JellyfishClientSdk && swift package update Mockingbird && ./gen-mocks.sh

      - name: Run tests ðŸ’€
        run: set -o pipefail && xcodebuild -scheme JellyfishClientSdkTests test -destination "platform=iOS Simulator,name=iPhone 14,OS=latest" | xcbeautify
